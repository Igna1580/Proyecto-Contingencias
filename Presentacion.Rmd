---
title: "Seguro de cuidados de largo plazo"
subtitle: "CA-309 Contingencias de Vida II"
author:
  - José Ignacio Rojas Zárate, C16911
  - María Carolina Navarro, C05513
  - Montserrat Beirute Abarca, C10997
  - Valeria Vásquez Venegas, C18373
date: "`r format(Sys.Date(), '%d de %B de %Y', locale = 'es_ES')`"
output:
  rmdformats::readthedown:
    code_folding: hide
  html_document:
    toc: TRUE
bibliography: bibliografia_contingencias.bib
csl: apa.csl  
editor_options: 
  chunk_output_type: console

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
<style>
body {
text-align: justify}
</style>

## Introducción

El presente trabajo tiene como objetivo presentar el diseño de un producto de cuidados de largo plazo para la población costarricense. El producto propuesto se llama **Longevidad Asegurada** y realiza pagos mensuales de forma vitalicia, dependiendo del estado de salud de la persona, siempre y cuando esta realice pagos de primas anuales hasta los 65 años. 

La propuesta actual se centra en ofrecer a los clientes un producto especializado que les brinde mayor seguridad de contar con ingresos mensuales en el futuro, proporcionándoles los recursos necesarios para hacer frente a gastos médicos, cirugías y cuidados en la etapa final de la vida, sin depender de apoyo financiero externo.

Debido a que este producto no se encuentra actualmente en el país, se utilizan como base para los cálculos los datos experimentales de probabilidad en el trabajo: "A multiple state model for pricing and reserving private long term care insurance contracts in Australia" [@leung2006multiple].

## Supuestos

Para poder crear un producto que sea rentable, se utilizaron herramientas de matemática actuarial y fue necesario tomar una serie de supuestos que se presentan a continuación: 

1. **Inflación:** Se considera un valor fijo de inflación de $2.88\%$. Este es un promedio de la inflación en Costa Rica en los últimos 10 años según datos de [@inflacion], alimentados por la base de datos del Fondo Monetario Internacional, Banco Mundial e indicador del IPC de la OCDE.  

2. **Tasa de descuento:** Se descargó la base de datos de la Curva de Rendimeinto Soberana del Banco Central a tres meses y se decidió considerar un promedio de las tasas de los últimos seis meses, específicamente desde 03/05/2023 al 07/11/2023 [@descuento]. Por lo tanto, se consdiera una tasa de descuento del $5.8\%$ para realizar los cálculos respectivos. 

3. **Gastos:** Se consideran unos gastos inciales de 20\% de la primera prima y 5\% de las subsiguientes primas. 

4. **Población:** Se utilizaron estadísticas demográficas del 2023 basadas en proyecciones a partir del año 2018 como fuente de datos de la población costarricense [@poblacion]. Estas estadísticas proporcionan información sobre la cantidad de personas costarricenses vivas, desglosadas por género, en edades que varían desde 0 hasta 100 años. El producto que se presenta en este informe está dirigido específicamente a personas con edades comprendidas entre 30 y 65 años, ya que se considera que es menos atractivo para un público más joven. A partir de los 45 años, se espera que el interés en este seguro se distribuya de manera más uniforme. A continuación, se presenta dos cuadros con la información de la población considerada en el diseño de este producto para hombres y mujeres. 

```{r, echo=FALSE, results='hide', message=FALSE}

suppressWarnings({
  library(tidyverse)
  library(janitor)
  library(dplyr)
  library(ggplot2)
  library(plotly)
  library(knitr)
  library(readxl)
  library("papaja")
  library(kableExtra)
})

Hombres_2023_demografia <- read_excel("repoblacev2011-2050-05_2.xlsx", sheet = "Cuadro 5 ", range = "G1017:G1177")
Mujeres_2023_demografia <- read_excel("repoblacev2011-2050-05_2.xlsx", sheet = "Cuadro 5 ", range = "G1857:G2017")

colnames(Hombres_2023_demografia) <- c("poblacion_Hombres")
colnames(Mujeres_2023_demografia) <- c("poblacion_Mujeres")
filtro <- c()
for (i in 0:19){
  filtro <- c(filtro, (4+i*8):(8+i*8))
}

Hombres_2023_demografia <- Hombres_2023_demografia[filtro,1]
Mujeres_2023_demografia <- Mujeres_2023_demografia[filtro,1]

Prob_Trans_Hombres <- read.csv("ProbTransHombres.csv", sep = ";")
Prob_Trans_Mujeres <- read.csv("ProbTransMujeres.csv", sep = ";")
edades <- 31:65

porcentajes <- c(0.05, 0.05, 0.8, 0.08, 0.10, 0.10, 0.15, 0.15, 0.20, 0.20, 0.25, 0.25, 0.30, 0.30, 0.35,
                 rep(0.6, 20))  # Luego, 20 porcentajes uniformes de 0.6
# Caso hombres 

# Crear un dataframe para las edades
edades_df <- data.frame(Edad = edades-1)

edades_seleccionadas_hombres <- Hombres_2023_demografia[edades,] 

# Unir el dataframe de edades con el dataframe de hombres
edades_seleccionadas_hombres <- cbind(edades_df, edades_seleccionadas_hombres)


# Luego puedes agregar este vector de porcentajes al dataframe edades_seleccionadas_hombres
edades_seleccionadas_hombres$Porcentajes_Diferentes <- porcentajes

# Calcular la población por edad (multiplicar la cantidad de hombres por el porcentaje)
edades_seleccionadas_hombres$Poblacion_por_Edad <- edades_seleccionadas_hombres$poblacion_Hombres* edades_seleccionadas_hombres$Porcentajes_Diferentes

# Caso Mujeres 
edades_seleccionadas_mujeres <- Mujeres_2023_demografia[edades,] 
edades_seleccionadas_mujeres <- cbind(edades_df, edades_seleccionadas_mujeres)
edades_seleccionadas_mujeres$Porcentajes_Diferentes <- porcentajes
edades_seleccionadas_mujeres$Poblacion_por_Edad <- edades_seleccionadas_mujeres$poblacion_Mujeres * edades_seleccionadas_mujeres$Porcentajes_Diferentes

edades_seleccionadas_hombres <- edades_seleccionadas_hombres %>%
  rename(
    "Número de hombres" = poblacion_Hombres,
    "Porcentaje" = Porcentajes_Diferentes,
    "Número de hombres considerados"= Poblacion_por_Edad
  )

edades_seleccionadas_mujeres <- edades_seleccionadas_mujeres %>%
  rename(
    "Número de mujeres" = poblacion_Mujeres,
    "Porcentaje" = Porcentajes_Diferentes,
    "Número de mujeres consideradas"= Poblacion_por_Edad
  )

tabla_html <- knitr::kable(edades_seleccionadas_mujeres, format = "html")
tabla_html_hombres <- knitr::kable(edades_seleccionadas_hombres, format = "html")

```

```{r, results='asis',echo=FALSE}
cat('<button onclick="var x = document.getElementById(', "'tabla_hombres'", '); if (x.style.display === ', "'none'", ') { x.style.display = ', "'block'", '; } else { x.style.display = ', "'none'", '; }"> Mostrar u ocultar cuadro hombres</button>')

cat('<div id="tabla_hombres" style="display: none;">')
cat(tabla_html_hombres)
cat('</div>')

cat('<button onclick="var x = document.getElementById(', "'tabla_mujeres'", '); if (x.style.display === ', "'none'", ') { x.style.display = ', "'block'", '; } else { x.style.display = ', "'none'", '; }"> Mostrar u ocultar cuadro mujeres</button>')

cat('<div id="tabla_mujeres" style="display: none;">')
cat(tabla_html)
cat('</div>')
```

## Diseño del producto 

Siguiendo la base del trabajo de @leung2006multiple, el modelo debe de considerar los siguientes cinco estados: 

Estado  | Nombre   |Transiciona a estados|
--------|----------|---------------------|
0       | capaz    |1, 2, 3, 4, 5.       |
1       | leve     |0, 2, 3, 4, 5.       |       
2       | moderado |1, 3, 4, 5.          |
3       | severo   |2, 4, 5.             |  
4       | profundo |3, 5.                |
5       | muerto   |ninguno              |

Si una persona que compra el seguro **Longevidad Asegurada**, que actualmente se encuentra en el estado de leve (1), dentro de un período futuro t, su estado de salud puede permanecer igual o cambiar a uno de los siguientes estados: capaz (0), moderado (2), severo (3), profundo (4) o muerto (5). Sin embargo, para una persona que hoy se encuentra en el estado profundo, en cualquier momento en el futuro, su estado de salud puede permanecer sin cambios, o puede cambiar a los estados severo (3) o muerto (5).

Para un mayor entendimiento, se presenta el siguiente gráfico de múltiples estados: 

```{r echo=FALSE, error=FALSE}
knitr::include_graphics("modelo.jpg")
```

En este gráfico, cada una de las flechas simboliza que existe probabilidad positiva ( > 0 ) de pasar de un estado "i" a un estado "j".


Lo primero que se realizó fue la creación de la tabla de probabilidades de transición para la población masculina y femenina. Esto implica conocer la probabilidad de transición de un estado "i" a un estado "j", que puede ser el mismo, para cada edad. Si desea ver cómo se realizó lo anterior, puede acceder a la visualización presionando el botón correspondiente. Además, se presenta la función que permite obtener las probabilidades de transición a un año de un estado "i" a un estado "j", para cada edad.

```{r, eval=TRUE, message=FALSE}

# Creamos una función llamada "obtencion_tabla_proyeccion", la cual va depender de tres parámetros: 
# la edad x, el estado en el cual se encuentra la persona a la edad x y el sexo de la persona. 

# Se toma las probabilidades del paper de Leung
obtencion_tabla_proyeccion <- function(x,status,sexo) {
  if (sexo == "H"){
    probabilidades <- Prob_Trans_Hombres
  }
  if (sexo == "M"){
    probabilidades <- Prob_Trans_Mujeres
  }
  
  tabla <- data.frame(
    "edad" = x:111,
    "l_age.x_sta.0" = rep(0, 112-x),
    "l_age.x_sta.1" = rep(0, 112-x),
    "l_age.x_sta.2" = rep(0, 112-x),
    "l_age.x_sta.3" = rep(0, 112-x),
    "l_age.x_sta.4" = rep(0, 112-x),
    "l_age.x_sta.5" = rep(0, 112-x)
  )
  tabla[1,status+2] = 1
  
  c(10000, rep(0, 111-x))
  
  
  for (fila in 2:nrow(tabla)){
    for (col in 2:7){
      tabla[fila,col] <- 
        tabla[fila-1,2]*probabilidades[(fila+x-21),col+1] + 
        tabla[fila-1,3]*probabilidades[(fila+x-21)+91,col+1] + 
        tabla[fila-1,4]*probabilidades[(fila+x-21)+182,col+1] + 
        tabla[fila-1,5]*probabilidades[(fila+x-21)+273,col+1] + 
        tabla[fila-1,6]*probabilidades[(fila+x-21)+364,col+1] + 
        tabla[fila-1,7]*probabilidades[(fila+x-21)+455,col+1]
    }
  }
  return (tabla)
}

# Ahora, creamos otra función para obtener las probabilidades de transición de un año, para una persona 
# de edad x, del estado i al estado j. 

tPx_ij <- function(t=1,x=65,i=0,j=0,sexo){
  p <- obtencion_tabla_proyeccion(x,i,sexo)[t+1,j+2]
  return(p)
}

```
### Propuesta #1

La primera propuesta considera un producto en el cual el cálculo de la prima es el mismo para todas las personas, sin importar su edad, la edad en la que adquieren el producto, su estado de salud o su sexo.

El producto va a pagar montos de anualidad diferentes dependiendo del estado en el que se encuentre la persona. Para ello, se utiliza la 






##  Bibliografía

\bibliography{bibliografia_contingencias.bib}






